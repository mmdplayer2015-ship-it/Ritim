<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rhythm Boss - PC & Mobil</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&display=swap');
        
        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; color: #fff; font-family: 'Syncopate', sans-serif; 
            overflow: hidden; touch-action: none;
        }

        /* OYUN ALANI */
        #game-board {
            position: relative; width: 100%; max-width: 500px; height: 100vh;
            margin: 0 auto; background: #0a0a0a; display: flex;
            border-left: 2px solid #222; border-right: 2px solid #222;
        }

        .lane { 
            position: relative; height: 100%; flex: 1;
            border-right: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: flex-end; justify-content: center;
            cursor: crosshair; /* PC'de tıklanabilir olduğunu belli eder */
            z-index: 10;
        }

        .lane:active { background: rgba(255, 255, 255, 0.1); } /* Tıklama geri bildirimi */

        .hit-zone-visual { 
            position: absolute; bottom: 12%; width: 100%; height: 80px; 
            border-top: 2px solid #0ff; background: rgba(0,255,255,0.05); pointer-events: none;
            z-index: 5;
        }

        .note { 
            position: absolute; width: 80%; height: 20px; border-radius: 10px;
            pointer-events: none; /* Notaya değil koridora tıklanmalı */
            z-index: 8;
        }

        /* RENKLER */
        .c0 { background: #f05; box-shadow: 0 0 15px #f05; }
        .c1 { background: #0f9; box-shadow: 0 0 15px #0f9; }
        .c2 { background: #0cf; box-shadow: 0 0 15px #0cf; }
        .c3 { background: #fc0; box-shadow: 0 0 15px #fc0; }

        /* UI */
        #hud { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; z-index: 100; }
        .btn-ui { background: #0ff; color: #000; border: none; padding: 10px; font-family: 'Syncopate'; cursor: pointer; font-weight: bold; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .key-input { background: #222; color: #0ff; border: 1px solid #444; width: 50px; height: 50px; text-align: center; margin: 5px; font-size: 20px; }
        .key-label { margin-bottom: 25px; font-size: 1.2rem; opacity: 0.4; pointer-events: none; }
    </style>
</head>
<body>

<div id="hud">
    <div style="color:#0ff">SCORE: <span id="score-val">0</span></div>
    <button class="btn-ui" onclick="openSettings()">AYARLAR</button>
</div>

<div id="game-board">
    <div class="hit-zone-visual"></div>
    <div class="lane" id="l0" onmousedown="handleInput(0)" ontouchstart="handleInput(0)"><div class="key-label" id="kb0">D</div></div>
    <div class="lane" id="l1" onmousedown="handleInput(1)" ontouchstart="handleInput(1)"><div class="key-label" id="kb1">F</div></div>
    <div class="lane" id="l2" onmousedown="handleInput(2)" ontouchstart="handleInput(2)"><div class="key-label" id="kb2">J</div></div>
    <div class="lane" id="l3" onmousedown="handleInput(3)" ontouchstart="handleInput(3)"><div class="key-label" id="kb3">K</div></div>
</div>

<div id="settings-modal" class="overlay">
    <h2>TUŞ AYARLARI</h2>
    <div>
        <input type="text" id="in0" class="key-input" maxlength="1">
        <input type="text" id="in1" class="key-input" maxlength="1">
        <input type="text" id="in2" class="key-input" maxlength="1">
        <input type="text" id="in3" class="key-input" maxlength="1">
    </div>
    <p id="err" style="color:#f05"></p>
    <button class="btn-ui" onclick="saveSettings()">KAYDET</button>
</div>

<div id="game-over" class="overlay">
    <h1 style="color:#f05">GAME OVER</h1>
    <h2 id="final-score">SCORE: 0</h2>
    <button class="btn-ui" onclick="restart()">TEKRAR DENE</button>
</div>

<script>
    let keys = JSON.parse(localStorage.getItem('rKeys')) || ['KeyD', 'KeyF', 'KeyJ', 'KeyK'];
    let score = 0;
    let notes = [];
    let isRunning = true;
    let speed = 6;

    function handleInput(laneIdx) {
        if(!isRunning) return;
        const h = window.innerHeight;
        // Hit zone toleransı: Ekranın %88'lik kısmının çevresi
        const hitStart = h * 0.88 - 100;
        const hitEnd = h * 0.88 + 40;

        const target = notes.findIndex(n => n.l === laneIdx && n.y > hitStart && n.y < hitEnd);

        if(target !== -1) {
            score += 10;
            document.getElementById('score-val').innerText = score;
            notes[target].el.remove();
            notes.splice(target, 1);
            speed += 0.04;
        } else {
            endGame();
        }
    }

    // Klavye Kontrolü
    window.onkeydown = (e) => {
        if(!isRunning) return;
        const idx = keys.indexOf(e.code);
        if(idx !== -1) handleInput(idx);
        else if(!['F11', 'F12'].includes(e.code)) endGame();
    };

    function spawn() {
        if(!isRunning) return;
        let l = Math.floor(Math.random()*4);
        let el = document.createElement('div');
        el.className = `note c${l}`;
        document.getElementById(`l${l}`).appendChild(el);
        notes.push({ el, l, y: -30 });
        setTimeout(spawn, Math.max(250, 800 - (score/2)));
    }

    function loop() {
        if(isRunning) {
            for(let i=notes.length-1; i>=0; i--) {
                notes[i].y += speed;
                notes[i].el.style.top = notes[i].y + 'px';
                if(notes[i].y > window.innerHeight) endGame();
            }
        }
        requestAnimationFrame(loop);
    }

    function openSettings() { isRunning = false; document.getElementById('settings-modal').style.display = 'flex'; }

    function saveSettings() {
        let newKeys = [];
        for(let i=0; i<4; i++) {
            let val = document.getElementById('in'+i).value.toUpperCase();
            if(!val) return;
            let kCode = isNaN(val) ? 'Key'+val : 'Digit'+val;
            if(newKeys.includes(kCode)) { document.getElementById('err').innerText = "Aynı tuş olmaz!"; return; }
            newKeys.push(kCode);
        }
        keys = newKeys;
        localStorage.setItem('rKeys', JSON.stringify(keys));
        document.getElementById('settings-modal').style.display = 'none';
        restart();
    }

    function endGame() { isRunning = false; document.getElementById('game-over').style.display = 'flex'; document.getElementById('final-score').innerText = "SCORE: " + score; }

    function restart() {
        notes.forEach(n => n.el.remove());
        notes = []; score = 0; speed = 6; isRunning = true;
        document.getElementById('score-val').innerText = "0";
        document.getElementById('game-over').style.display = 'none';
        keys.forEach((k, i) => document.getElementById('kb'+i).innerText = k.replace('Key','').replace('Digit',''));
    }

    keys.forEach((k, i) => document.getElementById('kb'+i).innerText = k.replace('Key','').replace('Digit',''));
    spawn();
    loop();
</script>
</body>
</html>
